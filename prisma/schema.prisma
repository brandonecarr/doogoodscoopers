// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
}

// Lead status enum for tracking lead progress
enum LeadStatus {
  NEW
  CONTACTED
  QUALIFIED
  CONVERTED
  LOST
}

// Lead source to track where leads come from
enum LeadSource {
  QUOTE_FORM       // Started quote but didn't complete
  OUT_OF_AREA      // Out of service area interest
  CAREERS          // Job application
  COMMERCIAL       // Commercial service inquiry
  AD_LEAD          // Meta/Facebook ads via Privyr
}

// =====================
// QUOTE LEADS
// =====================
// People who started the quote form but didn't complete signup
model QuoteLead {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Status tracking
  status          LeadStatus  @default(NEW)
  archived        Boolean     @default(false)
  notes           String?     @db.Text

  // Followup and grading
  followupDate    DateTime?
  grade           String?     // A, B, C, D, F

  // Contact info
  firstName       String
  lastName        String?
  email           String?
  phone           String

  // Address
  address         String?
  city            String?
  zipCode         String

  // Service details
  numberOfDogs    String?
  frequency       String?
  lastCleaned     String?

  // Gate info
  gateLocation    String?
  gateCode        String?

  // Step tracking - which step did they abandon?
  lastStep        String?

  // Dogs info (stored as JSON)
  dogsInfo        Json?

  @@index([status])
  @@index([archived])
  @@index([createdAt])
  @@index([zipCode])
  @@index([followupDate])
}

// =====================
// OUT OF AREA LEADS
// =====================
// People interested but outside service area
model OutOfAreaLead {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Status tracking
  status          LeadStatus  @default(NEW)
  archived        Boolean     @default(false)
  notes           String?     @db.Text

  // Followup and grading
  followupDate    DateTime?
  grade           String?     // A, B, C, D, F

  // Contact info
  firstName       String
  lastName        String
  email           String
  phone           String
  zipCode         String

  @@index([status])
  @@index([archived])
  @@index([createdAt])
  @@index([zipCode])
  @@index([followupDate])
}

// =====================
// CAREER APPLICATIONS
// =====================
model CareerApplication {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Status tracking
  status          LeadStatus  @default(NEW)
  archived        Boolean     @default(false)
  notes           String?     @db.Text

  // Followup and grading
  followupDate    DateTime?
  grade           String?     // A, B, C, D, F

  // Personal info
  firstName       String
  lastName        String
  email           String
  phone           String
  address         String
  city            String
  dateOfBirth     String?
  driversLicense  String?
  ssnLast4        String?

  // Employment eligibility
  legalCitizen    Boolean     @default(false)
  hasAutoInsurance Boolean    @default(false)
  convictedFelony Boolean     @default(false)

  // Work history
  references      String?     @db.Text
  currentEmployment String?   @db.Text
  workDuties      String?     @db.Text
  whyLeftPrevious String?     @db.Text
  mayContactEmployers Boolean @default(false)
  previousBossContact String? @db.Text

  // Motivation
  whyWorkHere     String?     @db.Text

  @@index([status])
  @@index([archived])
  @@index([createdAt])
  @@index([followupDate])
}

// =====================
// COMMERCIAL INQUIRIES
// =====================
model CommercialLead {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Status tracking
  status          LeadStatus  @default(NEW)
  archived        Boolean     @default(false)
  notes           String?     @db.Text

  // Followup and grading
  followupDate    DateTime?
  grade           String?     // A, B, C, D, F

  // Contact info
  contactName     String
  propertyName    String
  email           String
  phone           String

  // Location
  city            String
  state           String
  zipCode         String

  // Additional notes from form
  inquiry         String?     @db.Text

  @@index([status])
  @@index([archived])
  @@index([createdAt])
  @@index([followupDate])
}

// =====================
// AD LEADS (Meta/Facebook via Privyr)
// =====================
model AdLead {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  // Status tracking
  status          LeadStatus  @default(NEW)
  archived        Boolean     @default(false)
  notes           String?     @db.Text

  // Followup and grading
  followupDate    DateTime?
  grade           String?     // A, B, C, D, F

  // Contact info from ad form
  firstName       String?
  lastName        String?
  fullName        String?     // Some forms send full name instead
  email           String?
  phone           String?

  // Location (if provided)
  city            String?
  state           String?
  zipCode         String?

  // Ad campaign info
  adSource        String?     // e.g., "facebook", "instagram", "meta"
  campaignName    String?     // Name of the ad campaign
  adSetName       String?     // Ad set name
  adName          String?     // Individual ad name
  formName        String?     // Lead form name

  // Privyr specific fields
  privyrLeadId    String?     @unique  // Privyr's internal lead ID

  // Store any additional custom fields as JSON
  customFields    Json?

  // Raw webhook payload for debugging
  rawPayload      Json?

  @@index([status])
  @@index([archived])
  @@index([createdAt])
  @@index([adSource])
  @@index([privyrLeadId])
  @@index([followupDate])
}

// =====================
// ADMIN USERS
// =====================
model AdminUser {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())
  updatedAt       DateTime    @updatedAt

  email           String      @unique
  passwordHash    String
  name            String?

  @@index([email])
}

// =====================
// LEAD UPDATES
// =====================
// Track communication updates for leads
model LeadUpdate {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())

  // Which lead this update belongs to
  leadType        LeadSource
  leadId          String

  // Update content
  message         String      @db.Text
  communicationType String    // "phone_call", "text_message", "email", "in_person", "other"

  // Who added the update
  adminEmail      String

  @@index([leadType, leadId])
  @@index([createdAt])
}

// =====================
// ACTIVITY LOG
// =====================
// Track admin actions on leads
model ActivityLog {
  id              String      @id @default(cuid())
  createdAt       DateTime    @default(now())

  // Who performed the action
  adminEmail      String

  // What was the action
  action          String      // e.g., "status_change", "note_added", "viewed"

  // Which lead was affected
  leadType        LeadSource
  leadId          String

  // Details of the change
  details         Json?

  @@index([leadType, leadId])
  @@index([createdAt])
}
